<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ryan Morr Projects</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
</head>
<body>

<header>
    <h1>Projects</h1>
</header>

<div id="container"></div>

<script>
var container = document.getElementById('container');

var tpl = [
    '<section class="project">',
        '<h2 class="title"><a href="{{url}}">{{name}}</a></h2>',
        '<div class="description">{{description}}</div>',
        '<div class="updated">Last updated on {{updated}}</div>',
        '<div class="stars">{{stars}}</div>',
        '<div class="language">{{language}}</div>',
    '</section>'
].join('');

loadJSON('https://api.github.com/users/ryanmorr/repos', function(repos) {
    repos.sort(function (a, b) {
        return new Date(b.pushed_at).getTime() - new Date(a.pushed_at).getTime();
    }); 
    var frag = document.createDocumentFragment();
    repos.forEach(function(repo) {
        frag.appendChild(parseHTML(interpolate(tpl, {
            name: repo.name,
            url: repo.html_url,
            description: repo.description,
            language: repo.language,
            updated: getDate(repo.pushed_at),
            stars: repo.stargazers_count.toLocaleString()
        })));
    });
    container.appendChild(frag);
});

function interpolate(tpl, values) {
    return tpl.replace(/\{\{\s*(.+?)\s*\}\}/g, function(all, token) {
        return values[token];
    });
}

function parseHTML(html) {
    var div = document.createElement('div');
    div.innerHTML = html;
    return div.firstChild;
}

function getDate(str) {
    var months = [
        'Jan', 'Feb', 'Mar',
        'Apr', 'May', 'June', 'July',
        'Aug', 'Sept', 'Oct',
        'Nov', 'Dec'
    ];
    var date = new Date(str);
    var day = date.getDate();
    var month = date.getMonth();
    var year = date.getFullYear();
    return months[month] + ' ' + day + ' ' + year;
}

function loadJSON(url, callback) {   
    var xhr = new XMLHttpRequest();
    xhr.overrideMimeType('application/json');
    xhr.open('GET', url, true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            callback(JSON.parse(xhr.responseText));
        }
    };
    xhr.send();  
}
</script>

</body>
</html>